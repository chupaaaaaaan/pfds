# Exercise 8.5

cons と snoc がたかだか $1$、tail と init がたかだか $c + 1$ の負債を返済すれば、
不変条件 $D(i) \leq min(ci + i, cs + 1 - r)$ が各操作で維持されることを示す。

## 1. 回転が起こらない場合

### (a) cons

$|f|$ が $1$ 増加する。

- $|f| < |r|$ の場合、$s = |f|$, $t = |r|$ 。$ci  + i$, $cs + 1 - t$ のいずれも増加するため、不変条件は満たされる。
- $|f| \geq |r|$ の場合、$s = |r|$, $t = |f|$ 。$cs + 1 -t$ が $1$ 減少するが、$1$ 返済すれば不変条件を維持できる。

### (b) snoc

$f$ と $r$ を入れ替えれば、cons の場合と同様に示すことができる。

### (c) tail

$|f|$ が $1$ 減少する。

$ci  + i$は $c + 1$ 減少するが、$c + 1$ 返済すれば不変条件を維持できる。

- $|f| \geq |r|$ の場合、$s = |r|$, $t = |f|$ 。$cs + 1 - t$ は増加するので問題ない。
- $|f| < |r|$ の場合、$s = |f|$, $t = |r|$ 。$cs + 1 - t$ が $c$ 減少するが、$c + 1$ 返済すれば不変条件を維持できる。

### (d) init

$f$ と $r$ を入れ替えれば、tail の場合と同様に示すことができる。

## 2. 回転が起こる場合

### (a) cons または init

先頭側リスト、末尾側リストの長さがそれぞれ回転前は $cm + 2$、$m$、回転後は $|f|$、$|r|$ だったとすると、$|r| \leq |f| + 1$ が成り立つ。

末尾側リストの負債は、

$d(i) = 1 (i < m), d(i) = |r| - m (i = m), d(i) = 0 (i > m)$

$D(i) = i + 1 (i < m), D(i) = |r| (i \geq m)$ となり、

$c \geq 2$ ならば、$cs + 1 - t = c|f| + 1 - |r| \geq (c - 1)(|r| - 1) \geq |r| - 1 = D(i) - 1$ である。

したがって先頭ノードの負債を $1$ 返済すれば、$D(i) \leq cs + 1 - t$ と $D(i) \leq ci + i$ が成り立つ。

### (b) snoc または tail

$f$ と $r$ を入れ替えれば、cons または init の場合と同様に示すことができる。
